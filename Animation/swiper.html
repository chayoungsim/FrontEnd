<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/swiper-bundle.min.css">
    <script src="js/lib/jquery-3.2.1.min.js"></script>
    <style>
        .swiper-slide{width:100%;height:100vh;overflow:hidden}
        .swiper-slide video {
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            object-fit: cover;
        }
        .swiper-bg{width:100%;height:100%}
        
    </style>
</head>
<body>

<div id="wrap">
    <div class="swiper mySwiper">
        <div class="swiper-wrapper">
            <div class="swiper-slide" data-slide-type="vdo">
                <div class="swiper-bg">
                    <video muted class="swiper-lazy">
                        <source src="mov/mov1-h.mp4" type="video/mp4">
                    </video> 
                </div>
                <div class="swiper-lazy-preloader">
                    <span></span>
                </div>
            </div>
            <div class="swiper-slide" data-slide-type="vdo">
                <div class="swiper-bg">
                    <video muted class="swiper-lazy">
                        <source src="mov/mov2-h.mp4" type="video/mp4">
                    </video>
                </div>                
                <div class="swiper-lazy-preloader">
                    <span></span>
                </div>
            </div>
            <div class="swiper-slide" data-slide-type="img">
                <div class="swiper-bg img">
                    <img src="mov/main-vs1.jpg" alt="" class="swiper-lazy">
                </div>                
                <div class="swiper-lazy-preloader">
                    <span></span>
                </div>
            </div>
            <div class="swiper-slide" data-slide-type="vdo">
                <div class="swiper-bg">
                    <video muted class="swiper-lazy">
                        <source src="mov/mov4-h.mp4" type="video/mp4">
                    </video>
                </div>                
                <div class="swiper-lazy-preloader">
                    <span></span>
                </div>
            </div>
        </div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-pagination"></div>
    </div>
</div>

<!-- Swiper JS -->
<script src="js/lib/swiper.min.js"></script>

<!-- Initialize Swiper -->
<script>

// ie11 에서 실행안되는 문제
// swiper-lazy 와 에로우 평션때문인듯

var mySwiper = new Swiper(".mySwiper", {
    lazy:true,
    speed:500,
    effect:'fade',
    centeredSlides: true,
    loop:true,
    navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
    },
    pagination: {
        el: ".swiper-pagination",
        clickable: true,
    },
    on : {
        init : function(){
                     
        },
        transitionStart :function(){
            var videos = document.querySelectorAll('video');
            Array.prototype.forEach.call(videos, function(video){
                video.pause();
                video.currentTime = 0;
            });
            if (window.NodeList && !NodeList.prototype.forEach) {
                NodeList.prototype.forEach = Array.prototype.forEach;
            }
           
        },
        transitionEnd :function(){            
            var activeIndex = this.activeIndex;
            var activeSlide = document.getElementsByClassName('swiper-slide')[activeIndex];
            var activeSlideVideo = activeSlide.getElementsByTagName('video')[0];
            var activeSlideType = activeSlide.getAttribute('data-slide-type');   
            if(activeSlideType == 'vdo'){  
                var playPromise =  activeSlideVideo.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        // Automatic playback started!
                        activeSlideVideo.play();                    
                    })
                    .catch(error => {
                        // Auto-play was prevented
                        // Show paused UI.                       
                    });

                      
                }
                activeSlideVideo.play();       

                activeSlideVideo.addEventListener('ended',function(){
                    mySwiper.slideNext();
                })
            } else {
                console.log('이미지요');
               // clearTimeout(timeout);
                var timeout = setTimeout(function () {
                    mySwiper.slideNext();
				}, 3000)
            }
        }
    }
});
// 




</script>   

</body>
</html>